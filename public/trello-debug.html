<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trello API Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Trello API Debug Tool</h1>
    
    <div>
        <button onclick="testTrelloAPI()">Test Trello API</button>
        <button onclick="testWithProxy()">Test with Proxy</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div id="results"></div>
    
    <script src="config.js"></script>
    <script>
        function addResult(message, isError = false, data = null) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong>: ${message}
                ${data ? `<pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        async function testTrelloAPI() {
            addResult('🧪 Testing Trello API direct call...');
            
            try {
                // Check if config is loaded
                if (!window.API_CONFIG) {
                    throw new Error('API_CONFIG not loaded');
                }
                
                const { API_KEY, TOKEN, BOARD_ID } = window.API_CONFIG.TRELLO;
                addResult(`Config loaded - API_KEY: ${API_KEY ? '✓' : '✗'}, TOKEN: ${TOKEN ? '✓' : '✗'}, BOARD_ID: ${BOARD_ID}`);
                
                if (!API_KEY || !TOKEN) {
                    throw new Error('Missing Trello credentials');
                }
                
                const url = `https://api.trello.com/1/boards/${BOARD_ID}/lists?key=${API_KEY}&token=${TOKEN}`;
                addResult(`Making request to: ${url.substring(0, 60)}...`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                addResult(`Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const lists = await response.json();
                addResult(`✅ Success! Found ${lists.length} lists`, false, lists.slice(0, 3)); // Show first 3 lists
                
                // Test filtering
                const relevantLists = lists.filter(list => 
                    list.name.toLowerCase().includes('pre-order') || 
                    list.name.toLowerCase().includes('quoting') ||
                    list.name.toLowerCase().includes('quote') ||
                    list.name.toLowerCase().includes('sales')
                );
                
                addResult(`🎯 Found ${relevantLists.length} relevant lists`, false, relevantLists.map(l => ({ id: l.id, name: l.name })));
                
            } catch (error) {
                addResult(`❌ Error: ${error.message}`, true);
                console.error('Trello API test failed:', error);
            }
        }
        
        async function testWithProxy() {
            addResult('🔄 Testing with serverless proxy...');
            
            try {
                // Try to call Firebase function instead
                const functionUrl = 'https://us-central1-shureprint-quote-builder.cloudfunctions.net/api/api/trello/lists?boardId=686da04ff3f765a86406b2c0';
                addResult(`Trying proxy: ${functionUrl}`);
                
                const response = await fetch(functionUrl);
                addResult(`Proxy response: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addResult('✅ Proxy working!', false, data);
                } else {
                    const errorText = await response.text();
                    addResult(`❌ Proxy failed: ${errorText}`, true);
                }
                
            } catch (error) {
                addResult(`❌ Proxy error: ${error.message}`, true);
            }
        }
        
        // Run initial test on page load
        window.addEventListener('load', () => {
            setTimeout(testTrelloAPI, 1000);
        });
    </script>
</body>
</html>