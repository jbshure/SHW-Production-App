<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shureprint Quote Builder</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #000000;
      --secondary-color: #ffffff;
      --accent-color: #e3fc02;
      --neon: #E3FF33;
      --text-primary: #000000;
      --text-secondary: #666;
      --text-light: #999;
      --border-color: #e0e0e0;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --error-color: #dc3545;
      --background-light: #fff;
      --background-gray: #f8f9fa;
      --cream: #FFF9F0;
      --shadow-sm: 0 2px 4px rgba(0,0,0,.05);
      --shadow-md: 0 4px 12px rgba(0,0,0,.1);
      --shadow-lg: 0 8px 24px rgba(0,0,0,.15);
    }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f8f9fa; min-height: 100vh; color: var(--text-primary); line-height: 1.6; }
    .quote-builder { max-width: 1400px; margin: 20px auto; background: var(--background-light); border-radius: 8px; box-shadow: var(--shadow-sm); overflow: hidden; }
    /* Page Header */
    .page-header {
      background: var(--cream);
      padding: 20px 30px;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 20px;
    }
    
    .page-title {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }
    
    .nav-link {
      color: white;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .nav-link:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .header { background: var(--background-light); color: var(--text-primary); padding: 40px; position: relative; overflow: hidden; border-bottom: 1px solid var(--border-color); box-shadow: var(--shadow-sm); }
    .header::before { content: ''; position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: var(--accent-color); border-radius: 50%; opacity: .05; transform: translate(50px,-50px); }
    .header-content { position: relative; z-index: 2; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px; }
    .brand-section { display: flex; align-items: center; gap: 20px; }
    .logo-container { height: 60px; background: transparent; display: flex; align-items: center; justify-content: center; padding: 0 10px; }
    .brand-text h1 { font-size: 2.5rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 4px; color: var(--text-primary); }
    .brand-text p { font-size: 1rem; opacity: .8; font-weight: 400; color: var(--text-secondary); }
    .quote-number { background: var(--accent-color); color: #000; padding: 12px 20px; border-radius: 25px; font-weight: 700; font-size: 1.1rem; font-family: 'Montserrat', sans-serif; }
    .status-indicator { position: absolute; top: 20px; right: 20px; background: var(--success-color); color: #fff; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: .9rem; box-shadow: var(--shadow-sm); }
    .progress-bar { background: rgba(255,255,255,.2); border-radius: 10px; overflow: hidden; margin-top: 20px; height: 6px; }
    .progress-fill { background: var(--accent-color); height: 100%; transition: width .3s ease; width: 0%; border-radius: 10px; }
    .main-grid { display: grid; grid-template-columns: 1fr 380px; gap: 0; min-height: 800px; }
    .quote-form-section { padding: 40px; overflow-y: auto; max-height: 800px; }
    .quote-preview { background: var(--background-gray); border-left: 1px solid var(--border-color); padding: 40px 30px; overflow-y: auto; max-height: 800px; }
    .form-section { background: var(--background-light); border: 1px solid var(--border-color); border-radius: 8px; padding: 30px; margin-bottom: 20px; transition: all .3s ease; position: relative; }
    .form-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: var(--accent-color); transform: scaleX(0); transition: transform 0.3s ease; }
    .form-section:hover { box-shadow: var(--shadow-sm); border-color: var(--accent-color); }
    .form-section:hover::before { transform: scaleX(1); }
    .form-section h3 { color: var(--text-primary); margin-bottom: 24px; font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 12px; }
    .section-icon { width: 28px; height: 28px; background: var(--accent-color); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; color: #000; font-weight: 600; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px; }
    .form-group { display: flex; flex-direction: column; }
    .form-group.full-width { grid-column: 1 / -1; }
    label { font-family: 'Inter', sans-serif; font-weight: 500; color: var(--text-primary); margin-bottom: 8px; font-size: .9rem; }
    input, textarea, select { padding: 14px 16px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 15px; transition: all .3s ease; font-family: inherit; background: var(--background-light); color: var(--text-primary); }
    input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(227,252,2,.1); }
    .btn { padding: 14px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: .95rem; transition: all .3s ease; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; font-family: inherit; }
    .btn-primary { background: var(--accent-color); color: #000; font-weight: 600; }
    .btn-primary:hover { background: #d4ed02; transform: translateY(-1px); box-shadow: var(--shadow-md); }
    .btn-accent { background: var(--accent-color); color: #000; font-weight: 600; }
    .btn-accent:hover { background: #d4ed02; transform: translateY(-1px); box-shadow: var(--shadow-md); }
    .btn-outline { background: transparent; color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-outline:hover { background: var(--background-gray); border-color: var(--accent-color); }
    .quick-templates { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px,1fr)); gap: 16px; margin: 24px 0; }
    .template-btn { background: var(--background-light); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px 16px; text-align: center; cursor: pointer; transition: all .3s ease; font-size: .9rem; color: var(--text-primary); }
    .template-btn:hover { border-color: var(--accent-color); background: var(--background-gray); transform: translateY(-2px); box-shadow: var(--shadow-sm); }
    .items-table { width: 100%; border-collapse: collapse; margin: 24px 0; background: var(--background-light); border-radius: 12px; overflow: hidden; border: 1px solid var(--border-color); }
    .items-table th { background: var(--primary-color); color: #fff; padding: 16px 12px; text-align: left; font-weight: 500; font-size: .9rem; }
    .items-table td { padding: 14px 12px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
    .items-table tbody tr:hover { background: var(--background-gray); }
    .items-table input, .items-table select { width: 100%; border: 1px solid var(--border-color); padding: 6px 8px; font-size: 12px; border-radius: 6px; background: var(--background-light); }
    .main-cost-field, .main-unitprice-field, .main-setupfee-field { min-width: 80px; }
    .items-table th:nth-child(3), .items-table td:nth-child(3) { width: 120px; } /* Quantity */
    .items-table th:nth-child(4), .items-table td:nth-child(4) { width: 90px; } /* Cost */
    .items-table th:nth-child(5), .items-table td:nth-child(5) { width: 70px; } /* Markup */
    .items-table th:nth-child(6), .items-table td:nth-child(6) { width: 90px; } /* Unit Price */
    .items-table th:nth-child(7), .items-table td:nth-child(7) { width: 90px; } /* Setup Fee */
    .items-table th:nth-child(8), .items-table td:nth-child(8) { width: 90px; } /* Total */
    .items-table th:nth-child(9), .items-table td:nth-child(9) { width: 90px; } /* Actions */
    .preview-section { background: var(--background-light); border-radius: 8px; padding: 24px; margin-bottom: 20px; border: 1px solid var(--border-color); transition: all .3s ease; position: relative; }
    .preview-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent-color); transform: scaleX(0); transition: transform 0.3s ease; }
    .preview-section:hover { box-shadow: var(--shadow-sm); }
    .preview-section:hover::before { transform: scaleX(1); }
    .preview-header { color: var(--text-primary); font-size: 1.1rem; font-weight: 600; margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--accent-color); display: flex; align-items: center; gap: 8px; }
    .quote-summary { background: var(--primary-color); color: #fff; border-radius: 12px; padding: 24px; margin-bottom: 24px; }
    .summary-item { display: flex; justify-content: space-between; margin: 12px 0; padding: 8px 0; font-size: .95rem; }
    .summary-total { border-top: 1px solid rgba(255,255,255,.2); margin-top: 16px; padding-top: 16px; font-size: 1.25rem; font-weight: 600; }
    .actions-bar { display: flex; gap: 16px; margin-top: 40px; flex-wrap: wrap; justify-content: center; }
    .notification { position: fixed; top: 24px; right: 24px; background: var(--success-color); color: #fff; padding: 16px 24px; border-radius: 12px; font-weight: 500; z-index: 1000; transform: translateX(400px); transition: transform .3s ease; box-shadow: var(--shadow-lg); max-width: 350px; }
    .notification.show { transform: translateX(0); }
    .notification.error { background: var(--error-color); }
    .notification.warning { background: var(--warning-color); color: var(--text-primary); }
    .saved-indicator { color: var(--success-color); font-size: .85rem; margin-left: 12px; opacity: 0; transition: opacity .3s ease; font-weight: 500; }
    .saved-indicator.show { opacity: 1; }
    .floating-save-btn { position: fixed; bottom: 30px; right: 30px; background: var(--accent-color); color: #fff; border: none; border-radius: 50px; padding: 16px 24px; font-weight: 500; box-shadow: var(--shadow-lg); cursor: pointer; z-index: 100; transition: all .3s ease; font-family: inherit; }
    .floating-save-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 35px rgba(255,107,53,.4); }
    .ai-suggestions { background: linear-gradient(135deg,#fff5f2 0%,#fff 100%); border: 1px solid #ffd4c4; border-radius: 12px; padding: 20px; margin: 24px 0; }
    .ai-suggestions h4 { color: var(--text-primary); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; font-weight: 600; }
    .suggestion-item { background: var(--background-light); border-radius: 8px; padding: 12px 16px; margin: 8px 0; border-left: 3px solid var(--accent-color); cursor: pointer; transition: all .2s; font-size: .9rem; color: var(--text-secondary); }
    .suggestion-item:hover { transform: translateX(4px); box-shadow: var(--shadow-sm); background: #fff5f2; }
    .brand-badge { background: var(--accent-color); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: .8rem; font-weight: 500; display: inline-block; margin-left: 8px; }
    @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } .quote-preview { border-left: none; border-top: 1px solid var(--border-color); } .header-content { flex-direction: column; text-align: center; } .form-row { grid-template-columns: 1fr; gap: 16px; } }
    @media (max-width: 768px) { .quote-builder { margin: 10px; border-radius: 12px; } .header { padding: 30px 20px; } .quote-form-section, .quote-preview { padding: 20px; } .brand-text h1 { font-size: 2rem; } .actions-bar { flex-direction: column; } .btn { justify-content: center; width: 100%; } }
    ::-webkit-scrollbar{ width:6px } ::-webkit-scrollbar-track{ background:var(--background-gray) } ::-webkit-scrollbar-thumb{ background:var(--border-color); border-radius:3px } ::-webkit-scrollbar-thumb:hover{ background:var(--text-light) }
  </style>
</head>
<body>
  <div class="quote-builder with-sidebar">
    <!-- Page Header -->
    <div class="page-header">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1 class="page-title">Quote Builder</h1>
        <div id="emailStatus" style="display: flex; gap: 12px; align-items: center;">
          <div id="gmailNotConfigured" style="color: #28a745; font-size: 0.9rem;">Email Ready</div>
          <div id="gmailReady" style="color: #28a745; font-size: 0.9rem; display: none;">Gmail ready</div>
          <button id="connectGmail" onclick="handleAuthClick()" class="btn btn-outline" style="padding: 6px 12px; font-size: 0.8rem; display: none;">Connect Gmail</button>
        </div>
      </div>
    </div>
    
    <div class="header">
      <div class="status-indicator" id="statusIndicator">Draft</div>
      <div class="header-content">
        <div class="brand-section">
          <div class="quote-number" id="quoteNumber">QT-2025001</div>
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div class="main-grid">
      <div class="quote-form-section">
        <form id="quoteForm">
          <!-- Production Cards (single) -->
          <div class="form-section">
            <h3>Production Cards <span class="brand-badge">Trello Integration</span></h3>
            <div style="margin-bottom: 20px;">
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <select id="trelloListSelect" style="flex: 1;">
                  <option value="">Select a Trello list...</option>
                </select>
                <button type="button" onclick="testTrelloLoad()" class="btn btn-primary">Load Lists</button>
                <button type="button" onclick="testTrelloRefresh()" class="btn btn-primary">Load Cards</button>
              </div>
              <div id="trelloCardsList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; display: none;"></div>
            </div>
            <div id="selectedTrelloCards"></div>
            <div style="font-size: .9rem; color: var(--text-secondary); padding: 12px; background: var(--background-gray); border-radius: 8px;">💡 <strong>Tip:</strong> Select cards from Pre-Order Sales or Quoting to auto-populate quote items with existing project details.</div>
          </div>

          <!-- Client Information (single) -->
          <div class="form-section">
            <h3>Client Information <span class="saved-indicator" id="clientSaved">✓ Saved</span></h3>
            <div class="form-row">
              <div class="form-group">
                <label for="clientCompany">Company Name *</label>
                <input type="text" id="clientCompany" name="clientCompany" required placeholder="Enter company name" onchange="updateProgress()" />
              </div>
              <div class="form-group">
                <label for="contactName">Contact Name *</label>
                <input type="text" id="contactName" name="contactName" required placeholder="Enter contact name" onchange="updateProgress()" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="contactEmail">Email Address *</label>
                <input type="email" id="contactEmail" name="contactEmail" required placeholder="contact@company.com" onchange="updateProgress()" />
              </div>
              <div class="form-group">
                <label for="contactPhone">Phone Number</label>
                <input type="tel" id="contactPhone" name="contactPhone" placeholder="(555) 123-4567" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="projectName">Project Name *</label>
                <input type="text" id="projectName" name="projectName" required placeholder="Describe the printing project" onchange="updateProgress()" />
              </div>
              <div class="form-group">
                <label for="quoteValidUntil">Quote Valid Until</label>
                <input type="date" id="quoteValidUntil" name="quoteValidUntil" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="salesRepName">Sales Rep Name</label>
                <input type="text" id="salesRepName" placeholder="Your name" onchange="updateProgress()" />
              </div>
              <div class="form-group">
                <label for="salesRepEmail">Sales Rep Email</label>
                <input type="email" id="salesRepEmail" placeholder="you@shurehw.com" onchange="updateProgress()" />
              </div>
            </div>
          </div>

          <!-- Product Catalog -->
          <div class="form-section">
            <h3>Product Catalog</h3>
            <div style="margin-bottom: 20px;">
              <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                <select id="productCategorySelect" style="flex: 1;" onchange="filterByCategory()">
                  <option value="">Categories loaded from Airtable</option>
                </select>
                <button type="button" onclick="testAirtableLoad()" class="btn btn-primary">Load Catalog</button>
                <button type="button" onclick="testAirtableConnection()" class="btn btn-outline">Debug</button>
                <button type="button" onclick="toggleProductModal()" class="btn btn-primary">Browse Products</button>
              </div>
              <div style="font-size: .9rem; color: var(--text-secondary); padding: 12px; background: var(--background-gray); border-radius: 8px;"><strong>Product Catalog:</strong> Products and categories will load from Airtable when API is configured.</div>
            </div>
          </div>

          <!-- Quote Items -->
          <div class="form-section">
            <h3>Quote Items <span class="saved-indicator" id="itemsSaved">✓ Saved</span></h3>
            <div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
              <button type="button" onclick="addRow()" class="btn btn-primary">+ Add Item</button>
            </div>
            <table class="items-table" id="itemsTable">
              <thead>
                <tr>
                  <th>Product/Service</th>
                  <th>Specifications</th>
                  <th>Qty</th>
                  <th>Cost</th>
                  <th>Markup %</th>
                  <th>Unit Price</th>
                  <th>Setup Fee</th>
                  <th>Total</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="itemsTableBody">
                <tr>
                  <td><input type="text" name="product[]" placeholder="Enter product name" onchange="updateProgress(); updateQuoteNumber();" /></td>
                  <td><input type="text" name="specs[]" placeholder="Size, material, colors, etc." onchange="updateQuoteNumber();" /></td>
                  <td>
                    <div style="display: flex; gap: 4px; align-items: center;">
                      <input type="number" name="quantity[]" value="1000" min="1" onchange="calculateRow(this)" style="flex: 1; min-width: 50px; width: 70px;" />
                      <button type="button" onclick="openQuantityModal(this)" class="btn" style="padding: 4px 8px; font-size: .7rem; background: var(--accent-color); color: #000;" title="Add quantity variations">+</button>
                    </div>
                  </td>
                  <td><input type="number" name="cost[]" step="0.001" placeholder="0.000" onchange="calculateRow(this)" class="main-cost-field" /></td>
                  <td><input type="number" name="markup[]" value="50" min="0" step="1" onchange="calculateRow(this)" class="main-markup-field" /></td>
                  <td><input type="number" name="unitPrice[]" step="0.001" placeholder="0.000" onchange="calculateRow(this)" class="main-unitprice-field" /></td>
                  <td><input type="number" name="setupFee[]" step="0.01" placeholder="0.00" onchange="calculateRow(this)" class="main-setupfee-field" /></td>
                  <td><input type="number" name="total[]" step="0.01" placeholder="0.00" readonly class="main-total-field" /></td>
                  <td>
                    <div style="display: flex; gap: 4px;">
                      <button type="button" onclick="openItemDetailsModal(this)" class="btn" style="background: var(--accent-color); color: #000; padding: 6px 8px; font-size: .8rem;" title="Expand item details">⊞</button>
                      <button type="button" onclick="removeRow(this)" class="btn" style="background: var(--error-color); color: #fff; padding: 6px 8px; font-size: .8rem;">×</button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>


          <!-- Pricing & Terms -->
          <div class="form-section">
            <h3>Pricing & Terms</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="taxRate">Tax Rate (%)</label>
                <input type="number" id="taxRate" name="taxRate" value="9.5" step="0.01" onchange="calculateTotals()" />
                <small style="color: var(--text-light); font-size: .8rem;">LA County rate</small>
              </div>
              <div class="form-group">
                <label for="shippingCost">Shipping Cost ($)</label>
                <input type="number" id="shippingCost" name="shippingCost" value="0" step="0.01" min="0" onchange="calculateTotals()" />
                <small style="color: var(--text-light); font-size: .8rem;">Leave 0 for local pickup</small>
              </div>
              <div class="form-group">
                <label for="depositPercent">Required Deposit (%)</label>
                <input type="number" id="depositPercent" name="depositPercent" value="50" step="0.01" onchange="calculateTotals()" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="deliveryTime">Estimated Delivery</label>
                <select id="deliveryTime" name="deliveryTime">
                  <option value="3-5 business days">3-5 business days</option>
                  <option value="1-2 weeks" selected>1-2 weeks</option>
                  <option value="2-3 weeks">2-3 weeks</option>
                  <option value="3-4 weeks">3-4 weeks</option>
                  <option value="Custom timeline">Custom timeline</option>
                </select>
              </div>
              <div class="form-group">
                <label for="paymentTerms">Payment Terms</label>
                <select id="paymentTerms" name="paymentTerms">
                  <option value="50% deposit, balance on completion" selected>50% deposit, balance on completion</option>
                  <option value="Net 15">Net 15</option>
                  <option value="Net 30">Net 30</option>
                  <option value="Payment in full upfront">Payment in full upfront</option>
                </select>
              </div>
            </div>
            <div class="form-group full-width">
              <label for="specialInstructions">Special Instructions/Notes</label>
              <textarea id="specialInstructions" name="specialInstructions" placeholder="Any special requirements, deadlines, branding specifications, or notes for this project..." rows="3"></textarea>
            </div>
          </div>

          <div class="actions-bar">
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
              <div style="flex: 1; display: flex; gap: 10px;">
                <button type="button" onclick="sendToCustomer()" class="btn btn-accent">Send to Customer</button>
                <button type="button" onclick="showPaymentOptions('deposit')" class="btn btn-success" id="paymentBtn" style="display: none;">Collect Deposit</button>
                <button type="button" onclick="showPaymentOptions('final')" class="btn btn-success" id="finalPaymentBtn" style="display: none;">Collect Final Payment</button>
                <button type="button" onclick="previewQuote()" class="btn btn-primary">Preview</button>
                <button type="button" onclick="generatePDF()" class="btn btn-secondary">Generate PDF</button>
              </div>
              <div style="display: flex; align-items: center; gap: 8px; background: var(--background-gray); padding: 8px 12px; border-radius: 8px;">
                <input type="checkbox" id="createTrelloCard" checked style="width: 18px; height: 18px;">
                <label for="createTrelloCard" style="margin: 0; font-size: 0.9rem; color: var(--text-secondary); cursor: pointer;">
                  📋 Create Trello Card with PDF
                </label>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="quote-preview">
        <div class="preview-section">
          <div class="preview-header">Items Breakdown</div>
          <div id="itemsPreview"><p style="color: var(--text-light); font-style: italic; text-align: center; padding: 24px;">Add items to see preview</p></div>
        </div>

        <div class="preview-section">
          <div class="preview-header">Project Timeline</div>
          <div id="timelinePreview">
            <div style="color: var(--text-secondary); margin: 12px 0; display: flex; justify-content: space-between;"><strong>Quote Valid Until:</strong><span id="validUntilPreview">Not set</span></div>
            <div style="color: var(--text-secondary); margin: 12px 0; display: flex; justify-content: space-between;"><strong>Estimated Delivery:</strong><span id="deliveryPreview">1-2 weeks</span></div>
            <div style="color: var(--text-secondary); margin: 12px 0; display: flex; justify-content: space-between;"><strong>Payment Terms:</strong><span id="paymentPreview">50% deposit, balance on completion</span></div>
          </div>
        </div>


        <div class="preview-section" style="background: linear-gradient(135deg,#fff5f2 0%,#fff 100%); border: 1px solid #ffd4c4;">
          <div class="preview-header" style="border-bottom-color: var(--accent-color);">Shureprint</div>
          <div style="font-size: .9rem; color: var(--text-secondary); line-height: 1.6;">
            <p>LA-based print and packaging company devoted to branding, hospitality, and design.</p>
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #ffd4c4; font-size: .8rem;"><strong>Specializing in:</strong> Custom packaging, paper products, hospitality branding</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button class="floating-save-btn" onclick="autoSave()" id="floatingSaveBtn">Auto-Save</button>
  <div id="notification" class="notification"></div>

  <!-- Item Details Modal -->
  <div id="itemDetailsModal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5); z-index: 1002; padding: 20px; box-sizing: border-box;">
    <div role="dialog" aria-modal="true" aria-labelledby="itemDetailsModalTitle" style="background: #fff; max-width: 900px; margin: 50px auto; border-radius: 16px; max-height: 90vh; overflow: hidden; box-shadow: var(--shadow-lg);">
      <div style="padding: 30px 30px 20px 30px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
        <h2 id="itemDetailsModalTitle" style="margin: 0; color: var(--text-primary);">Item Details</h2>
        <button onclick="closeItemDetailsModal()" aria-label="Close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">×</button>
      </div>
      <div style="padding: 30px; max-height: calc(90vh - 100px); overflow-y: auto;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
          <!-- Left Column -->
          <div>
            <div style="margin-bottom: 20px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Product Name</label>
              <input type="text" id="modalProduct" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Specifications</label>
              <textarea id="modalSpecs" rows="4" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; resize: vertical;" onchange="updateItemFromModal()"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Additional Notes</label>
              <textarea id="modalNotes" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; resize: vertical;" placeholder="Internal notes (not shown to customer)" onchange="updateItemFromModal()"></textarea>
            </div>
          </div>
          
          <!-- Right Column -->
          <div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Quantity</label>
                <input type="number" id="modalQuantity" min="1" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
              </div>
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Cost per Unit</label>
                <input type="number" id="modalCost" step="0.001" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Markup %</label>
                <input type="number" id="modalMarkup" min="0" step="1" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
              </div>
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Unit Price</label>
                <input type="number" id="modalUnitPrice" step="0.001" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Setup Fee</label>
                <input type="number" id="modalSetupFee" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px;" onchange="updateItemFromModal()">
              </div>
              <div>
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);">Total</label>
                <input type="number" id="modalTotal" readonly style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--background-gray);">
              </div>
            </div>
            
            <!-- Quantity Variations Preview -->
            <div id="modalQuantityVariations" style="display: none; background: var(--background-gray); padding: 15px; border-radius: 8px; margin-top: 20px;">
              <h4 style="margin: 0 0 10px 0; color: var(--text-primary);">Quantity Variations</h4>
              <div id="modalVariationsList" style="font-size: 0.9rem; color: var(--text-secondary);"></div>
            </div>
          </div>
        </div>
        
        <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
          <button type="button" onclick="closeItemDetailsModal()" class="btn btn-outline">Cancel</button>
          <button type="button" onclick="saveItemDetails()" class="btn btn-accent">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Modal -->
  <div id="productModal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5); z-index: 1000; padding: 20px; box-sizing: border-box;">
    <div role="dialog" aria-modal="true" aria-labelledby="productCatalogTitle" style="background: #fff; max-width: 800px; margin: 50px auto; border-radius: 16px; max-height: 80vh; overflow: hidden; box-shadow: var(--shadow-lg);">
      <div style="padding: 30px 30px 20px 30px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
        <h2 id="productCatalogTitle" style="margin: 0; color: var(--text-primary);">Product Catalog</h2>
        <button onclick="toggleProductModal()" aria-label="Close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">×</button>
      </div>
      <div style="padding: 20px 30px;">
        <input type="text" id="productSearch" placeholder="Search products..." style="width: 100%; margin-bottom: 20px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px;" onkeyup="filterProducts()" />
        <div id="productCatalog" style="max-height: 400px; overflow-y: auto;"></div>
      </div>
    </div>
  </div>

  <!-- Quantity Variations Modal -->
  <div id="quantityModal" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5); z-index: 1001; padding: 20px; box-sizing: border-box;">
    <div role="dialog" aria-modal="true" aria-labelledby="quantityModalTitle" style="background: #fff; max-width: 700px; margin: 50px auto; border-radius: 16px; max-height: 80vh; overflow: hidden; box-shadow: var(--shadow-lg);">
      <div style="padding: 30px 30px 20px 30px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
        <h2 id="quantityModalTitle" style="margin: 0; color: var(--text-primary);">Quantity Variations & Pricing</h2>
        <button onclick="closeQuantityModal()" aria-label="Close" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">×</button>
      </div>
      <div style="padding: 20px 30px;">
        <p style="color: var(--text-secondary); margin-bottom: 20px;">Add different quantity options with their respective costs and markups for this item.</p>
        
        <table class="items-table" style="width: 100%; margin-bottom: 20px;">
          <thead>
            <tr>
              <th>Quantity</th>
              <th>Cost per Unit</th>
              <th>Markup %</th>
              <th>Unit Price</th>
              <th>Total</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="quantityVariationsBody">
            <!-- Variations will be added here -->
          </tbody>
        </table>
        
        <div style="display: flex; gap: 12px; justify-content: space-between;">
          <button type="button" onclick="addQuantityVariation()" class="btn btn-primary">+ Add Variation</button>
          <button type="button" onclick="saveQuantityVariations()" class="btn btn-accent">Save & Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <!-- <script src="api-test.js"></script>
  <script src="api-integration.js"></script> -->
  <script>
    // Debug check immediately after loading
    console.log('🔍 Script loading check:');
    console.log('- API_CONFIG:', !!window.API_CONFIG);
    console.log('- testFunction:', typeof window.testFunction);
    console.log('- loadTrelloLists:', typeof window.loadTrelloLists);
    console.log('- loadProductCatalogFromAirtable:', typeof window.loadProductCatalogFromAirtable);
  </script>
  <script src="complete-javascript.js"></script>

  <!-- Quantity Variations Modal -->
  <div id="quantityModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div class="modal-content" style="position: relative; background: white; margin: 5% auto; padding: 30px; width: 90%; max-width: 600px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
      <span class="close" onclick="closeQuantityModal()" style="position: absolute; right: 20px; top: 20px; font-size: 28px; cursor: pointer; color: #999;">&times;</span>
      <h2 style="margin-bottom: 20px; color: #333;">Quantity Variations</h2>
      <p style="color: #666; margin-bottom: 20px;">Add different quantity options for this product. The customer will see all options.</p>
      
      <div id="quantityVariations" style="max-height: 400px; overflow-y: auto;">
        <!-- Variations will be added here -->
      </div>
      
      <div style="margin-top: 20px; display: flex; gap: 10px;">
        <button type="button" onclick="addQuantityVariation()" class="btn btn-primary">+ Add Variation</button>
        <button type="button" onclick="saveQuantityVariations()" class="btn btn-success">Save Variations</button>
        <button type="button" onclick="closeQuantityModal()" class="btn btn-outline">Cancel</button>
      </div>
    </div>
  </div>

</body>
</html>
